{% extends 'base.html' %}
{% block css %}
    <style>
        #theButtonContainer {
            margin-top: 10px;
        }

        #allTabsContainer div {
        {#min-height:60vh;#}
        }

        .tabDetails {
            min-height: 60vh;
        }
    </style>
{% endblock %}

{% block content %}
    {% include 'navBar.html' %}
    <div class="row">
        <div class="col s8">

            <h4><a href="">{{ user }} </a>/<a
                    href="{% url 'detail_repo' owner=repo.owner name=repo.name %}">{{ repo.name }}</a></h4>

            {#            <div class="row">#}
            {#                <div class="col s12">#}
            {#                    <ul class="tabs">#}
            {#                        <li class="tab col s2 "><a class="active" href="#codeTab">Code</a></li>#}
            {#                        <li class="tab col s2"><a href="#issuesTab">Issues</a></li>#}
            {#                        <li class="tab col s2 "><a href="#pullRequestTab">Pull request </a></li>#}
            {#                        <li class="tab col s2"><a href="#securityTab">Security</a></li>#}
            {#                        <li class="tab col s2"><a href="#settingsTab">Settings</a></li>#}
            {#                    </ul>#}
            {#                </div>#}
            {##}
            {#            </div>#}
            <div class="row">
                <div class="col s12">
                    <ul class="tabs">
                        <li class="tab col s2"><a  class="active" href="#test1">Code</a></li>
                        <li class="tab col s2"><a href="#test2">Issues</a></li>
                        <li class="tab col s2 "><a href="#test3">Pull request</a></li>
                        <li class="tab col s2"><a href="#test4">Security</a></li>
                        <li class="tab col s2"><a href="#test5">Settings</a></li>
                    </ul>
                </div>

            </div>

            <!-- Modal Trigger -->

        </div>
        <div class="col s4">
            <div id="theButtonContainer" class="container">
                <div class="row">
                    <div class="col right" id="star-section">
                        {% include 'Repos/star-section.html' %}
                    </div>

                    <a class="col right" href="{% url 'profile' user %}">
                        <button class="btn purple lighten-1" type="submit">Profile</button>
                    </a>
                    <a class="col right" href="{% url 'profile' user %}">
                        <button class="btn purple lighten-1" type="submit">Watch</button>
                    </a>

                    {% if repo.parent %}
                        <p>This repo is forked from</p>
                        <a class="waves-effect waves-light modal-trigger"
                           href="{% url 'detail_repo' owner=repo.parent.owner name=repo.name %}">{{ repo.parent.owner }}/{{ repo.name }}/</a>
                    {% endif %}
                    {% if repo.owner != request.user %}
                        <a class="waves-effect waves-light btn modal-trigger" href="{% url 'fork' repo.pk %}">Fork
                            Repository</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s9">
            <div id="codeTab" class="row">
                <div class="col s11 offset-s1">
                    <div class="row">
                        <div class="row">

                            <div id="test1" class="col s12">   {% include 'Repos/codeTab.html' %}#}</div>
                            <div id="test2" class="col s12"> {% include 'Repos/issueTab.html' %}</div>
                            <div id="test3" class="col s12">{% include 'Repos/pullRequestTab.html' %}</div>
                            <div id="test4" class="col s12"> {% include 'Repos/securityTab.html' %}</div>
                            <div id="test5" class="col s12">{% include 'Repos/settingsTab.html' %}</div>
                        </div>

                    </div>

                </div>
            </div>
        </div>
        <div class="col s3 " style="background-color:red;">
            sfdsfsd
        </div>
    </div>
    <!-- Modal Structure -->
    <div id="modal1" class="modal">
        <div class="modal-content">
            <h4>Delete Repository</h4>
            <p>Once deleted you can not undo it</p>
            <p>Type "{{ repo.owner }}/{{ repo.name }}/" to confirm delete</p>
            <input type="text" placeholder="Type here" id="delete_box">
        </div>
        <div class="modal-footer">
            <a href="{% url 'delete_repo' owner=repo.owner name=repo.name %}">
                <button class="btn" disabled="disabled" id="delete_btn"> Delete</button>
            </a>
        </div>
    </div>


{% endblock %}

{% block script %}
    <script>
        $(document).ready(function () {
            $('#delete_box').keyup(function () {
                var btnSubmit = $("#delete_btn");
                var text = "{{ repo.owner }}/{{ repo.name }}/";
                if ($(this).val() === text) {
                    btnSubmit.removeAttr("disabled");
                } else {
                    btnSubmit.attr("disabled", "disabled");
                }
            })
        });
    </script>
    <script>
        $(document).ready(function () {
            $('.modal').modal();
            $('select').formSelect();
            $('.tabs').tabs();

            $(document).on('click', '#starbtn', function (event) {
                event.preventDefault()
                var iid = {{ repo.pk }}
                    $.ajax({
                        url: '{% url "star" %}',
                        type: 'post',
                        data: {
                            csrfmiddlewaretoken: "{{csrf_token}}",
                            id: iid,
                        },
                        success: function (data) {
                            $('#star-section').html(data['html'])
                        },
                        error: function (data) {
                            $("#errorToast").toast("show");
                        }
                    })
            })
        })
    </script>
{% endblock %}